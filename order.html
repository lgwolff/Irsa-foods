<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Place Order</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>Checkout</h2>

<form id="orderForm">
  <input required placeholder="Full Name" id="name"><br><br>
  <input required placeholder="Phone" id="phone"><br><br>
  <input required placeholder="City" id="city"><br><br>
  <textarea required placeholder="Address" id="address"></textarea><br><br>

  <button type="submit">Place Order</button>
</form>

<p id="status"></p>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5MPPFe33xZ2rKIdf2NBwr0Hannr4bBBPo9Vdl7ryjEMi_nY-m_A71PnoHYR6Srrd7/exec";

document.getElementById("orderForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  if (cart.length === 0) {
    alert("Cart is empty");
    return;
  }

  const total = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
  const upfrontFee = 200;
  const remainingCOD = total;

  const payload = {
    name: name.value,
    phone: phone.value,
    city: city.value,
    address: address.value,
    cart,
    total,
    upfrontFee,
    remainingCOD
  };

  document.getElementById("status").innerText = "Placing order...";

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "application/json" }
    });

    const result = await res.json();

    if (result.status === "success") {
      document.getElementById("status").innerText = "Order placed successfully!";
      localStorage.removeItem("cart");
    } else {
      throw new Error(result.message);
    }

  } catch (err) {
    document.getElementById("status").innerText = "Order failed. Check configuration.";
    console.error(err);
  }
});
</script>

</body>
</html>

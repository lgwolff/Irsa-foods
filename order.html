<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Place Your Order | Irsa Foods</title>
<link rel="stylesheet" href="css/style.css">
<style>
body { font-family: Arial; margin:0; padding:0; background:#fff; color:#212121; }
header { display:flex; justify-content:space-between; align-items:center; padding:20px; border-bottom:1px solid #eee; }
.logo { display:flex; align-items:center; }
.logo img { height:50px; margin-right:10px; }
.logo span { color:#D90416; font-size:24px; font-weight:bold; }
nav a { margin:0 15px; color:#212121; text-decoration:none; font-weight:bold; }
nav a:hover { color:#D90416; }
main { padding:20px; max-width:800px; margin:auto; }
h1 { color:#D90416; margin-bottom:20px; text-align:center; }

.products-list { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:20px; margin-bottom:20px; }
.product-card { border:1px solid #eee; padding:15px; border-radius:8px; text-align:center; }
.product-card img { width:100%; height:auto; margin-bottom:10px; }
.product-card input[type="number"] { width:60px; margin-top:5px; padding:5px; }

.cart-summary { border:1px solid #D90416; padding:15px; border-radius:8px; margin-bottom:20px; background:#fef0f0; }
.cart-summary h2 { color:#D90416; margin-bottom:10px; }
.cart-summary p { margin:5px 0; }

button { background:#D90416; color:#fff; padding:12px; font-size:16px; border:none; border-radius:5px; cursor:pointer; margin-top:10px; }
button:hover { background:#F25C54; }

form input, form textarea { width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; font-size:16px; }

footer { background:#212121; color:#fff; padding:20px; text-align:center; margin-top:40px; }
footer a { color:#F25C54; text-decoration:none; margin:0 5px; }
</style>
</head>
<body>

<header>
<div class="logo">
<img src="images/logo.png" alt="Irsa Foods Logo">
<span>Irsa Foods</span>
</div>
<nav>
<a href="index.html">Home</a>
<a href="order.html">Order</a>
<a href="faq.html">FAQ</a>
<a href="contact.html">Contact</a>
<div class="dropdown">
<span>Policies</span>
<div class="dropdown-content">
<a href="policies/privacy-policy.html">Privacy Policy</a>
<a href="policies/terms.html">Terms</a>
<a href="policies/disclaimer.html">Disclaimer</a>
</div>
</div>
</nav>
</header>

<main>
<h1>Place Your Order</h1>
<p>Select products, set quantity, and place your order. PKR 200 upfront fee per order is required. Remaining will be collected on delivery.</p>

<!-- Products Grid -->
<div class="products-list" id="products-list">
  <!-- Products populated by JS -->
</div>

<!-- Cart Summary -->
<div class="cart-summary" id="cart-summary">
<h2>Cart Summary</h2>
<p>No products added yet.</p>
</div>

<!-- Customer Details Form -->
<form id="customer-form">
<input type="text" id="name" placeholder="Full Name" required>
<input type="tel" id="phone" placeholder="Phone Number" required>
<textarea id="address" placeholder="Delivery Address" rows="3" required></textarea>
<button type="submit">Place Order</button>
</form>

<p id="confirmation" style="margin-top:20px; font-weight:bold; color:#D90416;"></p>
</main>

<footer>
<p>Contact us: +923177910929</p>
<p>
<a href="policies/privacy-policy.html">Privacy Policy</a> | 
<a href="policies/terms.html">Terms</a> | 
<a href="policies/disclaimer.html">Disclaimer</a>
</p>
</footer>

<script>
// Google Sheet API Link
const SHEET_ENDPOINT = "https://script.google.com/macros/s/AKfycbythDs2Wgo_VGC8TsQ1wX3UThTyJ5ASp8HsFf-Ew3yjCu8aLE_WGvqrkf_8sw/exec";

const UPFRONT_FEE = 200;

// Product List
const products = [
  {name:"BelVita Biscuits", price:150, image:"images/belvita.jpg"},
  {name:"Lip Gloss", price:250, image:"images/lip-gloss.jpg"}
  // Add more products here
];

let cart = [];

// Populate Products Grid
const productsList = document.getElementById('products-list');
products.forEach((p, idx)=>{
  const div = document.createElement('div');
  div.className = 'product-card';
  div.innerHTML = `
    <img src="${p.image}" alt="${p.name}">
    <h3>${p.name}</h3>
    <p>PKR ${p.price}</p>
    <label>Quantity: <input type="number" min="0" value="0" data-index="${idx}"></label>
  `;
  productsList.appendChild(div);
});

// Update Cart Summary
function updateCart(){
  const summary = document.getElementById('cart-summary');
  const cartItems = cart.filter(item=>item.quantity>0);
  if(cartItems.length===0){
    summary.innerHTML = '<h2>Cart Summary</h2><p>No products added yet.</p>';
    return;
  }
  let html = '<h2>Cart Summary</h2>';
  let subtotal = 0;
  cartItems.forEach(item=>{
    html += `<p>${item.name} x ${item.quantity} = PKR ${item.price*item.quantity}</p>`;
    subtotal += item.price*item.quantity;
  });
  const codAmount = Math.max(subtotal - UPFRONT_FEE,0);
  html += `<p><strong>Upfront Fee:</strong> PKR ${UPFRONT_FEE}</p>`;
  html += `<p><strong>Remaining COD:</strong> PKR ${codAmount}</p>`;
  summary.innerHTML = html;
}

// Listen for Quantity Changes
productsList.querySelectorAll('input[type="number"]').forEach(input=>{
  input.addEventListener('input', ()=>{
    const idx = input.dataset.index;
    const qty = parseInt(input.value) || 0;
    cart[idx] = { ...products[idx], quantity: qty };
    updateCart();
  });
});

// Handle Order Submission
const form = document.getElementById('customer-form');
const confirmation = document.getElementById('confirmation');

form.addEventListener('submit', function(e){
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const cartItems = cart.filter(item=>item.quantity>0);

  if(cartItems.length===0){
    confirmation.textContent = "Please add at least one product to the cart.";
    return;
  }

  const subtotal = cartItems.reduce((sum,item)=>sum+item.price*item.quantity,0);
  const orderData = {
    name, phone, address,
    products: cartItems.map(i=>({name:i.name, quantity:i.quantity, price:i.price})),
    upfrontFee: UPFRONT_FEE,
    codAmount: Math.max(subtotal - UPFRONT_FEE,0)
  };

  // Send to Google Sheets
  fetch(SHEET_ENDPOINT, {
    method:'POST',
    body: JSON.stringify(orderData)
  }).then(res=>res.json())
    .then(data=>{
      confirmation.textContent = `Thank you ${name}! Please pay PKR ${orderData.upfrontFee} now. Remaining PKR ${orderData.codAmount} will be collected on delivery.`;
      form.reset();
      cart = [];
      productsList.querySelectorAll('input[type="number"]').forEach(i=>i.value=0);
      updateCart();
    })
    .catch(err=>{
      confirmation.textContent = "Something went wrong. Please try again.";
      console.error(err);
    });
});
</script>

</body>
</html>
